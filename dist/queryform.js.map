{"version":3,"file":"queryform.js","sources":["../src/queryform.js"],"sourcesContent":["class Queryform {\n\n  constructor(websiteId, apiRoute = 'https://queryform.test/api/website/') {\n    this.websiteId = websiteId;\n    this.domainUTMs = [];\n    this.apiRoute = apiRoute;\n  }\n\n async #getDomainParamsFromQueryform() {\n      try {\n        const response = await fetch(this.apiRoute + this.websiteId);\n        if (response.ok) {\n          this.domainUTMs = await response.json();\n        }\n      } catch (err) {\n        console.warn('Something went wrong.', err);\n      }\n  }\n\n  init(config = { debug: false }) {\n\n    this.#getDomainParamsFromQueryform().then(() => {\n      this.#configureQueryform();\n    });\n\n    if(config.debug){\n      console.log(`%c Queryform` + `%c v1.0` + `%c Data synced.`, 'background: #222; color: #2563eb; padding: 10px 10px 10px 10px;', 'background: #222; color: #fff; font-size:8px; padding: 12px 10px 11px 0;', 'background: #222; color: #777; font-size:8px; padding: 12px 10px 11px 0');\n    }\n\n  }\n\n  async #configureQueryform() {\n    const queryStrings = this.#parseURLParams();\n    this.#saveParams(queryStrings);\n    const utms = this.getStoredParams();\n    // Check if the domain has any utm parameters stored in local storage\n    if(Object.keys(utms).length !== 0){\n        this.#populateFormInputs(utms, this.domainUTMs);\n    }\n  }\n\n  #isLocalStorageAvailable() {\n    return typeof(Storage) !== 'undefined';\n  }\n\n  #parseURLParams() {\n    const urlParams = new URLSearchParams(window.location.search);\n    const utms = {};\n    const arr = Object.values(this.domainUTMs);\n\n    arr.forEach((domainUTM) => {\n      if (urlParams.has(domainUTM.param)) {\n        utms[domainUTM.param] = urlParams.get(domainUTM.param);\n      }\n    });\n\n    return Object.keys(utms).length !== 0 ? utms : false;\n  }\n\n  #saveParams(queryStrings) {\n    if (this.#isLocalStorageAvailable()) {\n      let utms = this.getStoredParams();\n      if (queryStrings) {\n        if (!utms) {\n          utms = {};\n        }\n        this.domainUTMs.forEach((domainUTM) => {\n          if (queryStrings[domainUTM.param]) {\n            utms[domainUTM.param] = {\n              class_name: domainUTM.class_name,\n              value: queryStrings[domainUTM.param]\n            };\n          }\n        });\n        localStorage.setItem('queryform_data', JSON.stringify(utms));\n      }\n    }\n  }\n\n  getStoredParams() {\n    if (this.#isLocalStorageAvailable()) {\n      let utms = JSON.parse(localStorage.getItem('queryform_data'));\n      if (utms !== null) {\n        return utms;\n      }\n    }\n    return {};\n  }\n\n  #populateFormInputs(utms, domainUTMs) {\n\n    let formInputClasses = [];\n    let arrDomainUTMs = Object.values(domainUTMs);\n\n    Object.keys(utms).forEach(function(key, index) {\n      formInputClasses.push('.' + utms[key].class_name);\n    });\n\n    const formInputs = document.querySelectorAll(formInputClasses);\n\n    formInputs.forEach((inputElement) => {\n      const input = inputElement.tagName.toLowerCase() === 'input' ? inputElement : inputElement.querySelector('input');\n      if (!input) return;\n\n      const classNames = inputElement.className.split(' ');\n\n      classNames.forEach((className) => {\n        if (formInputClasses.includes('.' + className)) {\n          arrDomainUTMs.forEach((domainUTM) => {\n            if (className === domainUTM.class_name) {\n              input.value = utms[domainUTM.param].value;\n            }\n          });\n        }\n      });\n    });\n\n  }\n\n}\n\nexport default QueryForm;\n\n// Optionally, add it to the window object\n// window.QueryForm = QueryForm;\n"],"names":["QueryForm$1"],"mappings":"AAyHA,MAAAA,IAAe;"}