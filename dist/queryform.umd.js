(function(o,i){typeof exports=="object"&&typeof module<"u"?module.exports=i():typeof define=="function"&&define.amd?define(i):(o=typeof globalThis<"u"?globalThis:o||self,o.QueryForm=i())})(this,function(){"use strict";class o{constructor(e=null,a="https://queryform.co/api/website/"){this.websiteId=e,this.domainUTMs=[],this.apiRoute=a,this.debug=!1,this.local=!1,this.cacheUntil=null}async fetchDomainParams(){this.logMessage("Fetching parameters from queryform api.");try{const e=await fetch(`${this.apiRoute}${this.websiteId}`);if(e.ok){const a=await e.json();this.domainUTMs=a.parameters,this.cacheUntil=a.cache_until;const r=this.getSavedQueryformData().values||{};this.saveQueryformData(a.parameters,r,a.cache_until)}else console.warn("Failed to fetch domain parameters:",e.statusText)}catch(e){console.warn("Error fetching domain parameters:",e)}}async init(e={debug:!1,local:!1},a=[]){if(this.debug=e.debug,this.local=e.local,this.local)this.fetchLocalParams(a);else{const t=this.getCacheUntil(),r=new Date(t),s=new Date(new Date().toLocaleString("en-US",{timeZone:"America/New_York"}));r>s?this.logMessage(`Cache is still valid until ${t}`):await this.fetchDomainParams()}this.configureQueryform()}fetchLocalParams(e){if(!Array.isArray(e)){console.warn("Invalid utms array:",e);return}if(e.some(({param:r,class_name:s})=>!r||!s)){console.warn("Invalid utms array sub-items:",e);return}const t=this.getSavedQueryformData().values||{};this.saveQueryformData(e,t,null)}configureQueryform(){const e=this.parseURLParams();this.storeParams(e);const a=this.getSavedQueryformData(),t=a.params,r=a.values;r&&Object.keys(r).length>0&&(this.logMessage("Populating form inputs."),this.populateFormInputs(r,t))}logMessage(e){this.debug&&console.log(`%c Queryform%c v1.0%c ${e}`,"background: #222; color: #2563eb; padding: 10px;","background: #222; color: #fff; font-size:8px; padding: 12px 10px;","background: #222; color: #777; font-size:8px; padding: 12px 10px;")}isLocalStorageAvailable(){return typeof Storage<"u"}parseURLParams(){const e=new URLSearchParams(window.location.search);if(!e)return;const a={};return this.getSavedQueryformData().params.forEach(({param:r})=>{e.has(r)&&(a[r]=e.get(r),this.logMessage(`Valid URL parameter found [${r}].`))}),Object.keys(a).length>0?a:null}storeParams(e){if(!this.isLocalStorageAvailable()||!e)return;const a=this.getSavedQueryformData();a.params.forEach(({param:t,class_name:r})=>{e[t]&&(a.values[t]={class_name:r,value:e[t]})}),this.saveQueryformData(a.params,a.values,a.cacheUntil)}getStoredParamValues(){return this.isLocalStorageAvailable()?this.getSavedQueryformData().values:{}}getStoredParams(){return this.isLocalStorageAvailable()?this.getSavedQueryformData().params:{}}getCacheUntil(){return this.getSavedQueryformData().cacheUntil}getSavedQueryformData(){return this.isLocalStorageAvailable()?JSON.parse(localStorage.getItem("queryform"))||{}:{}}saveQueryformData(e,a,t){if(this.isLocalStorageAvailable())return localStorage.setItem("queryform",JSON.stringify({params:e,values:a,cacheUntil:t})),this.getSavedQueryformData()}populateFormInputs(e,a){const t=Object.values(e).map(({class_name:s})=>`.${s}`);document.querySelectorAll(t.join(",")).forEach(s=>{var l;const u=s.tagName.toLowerCase()==="input"?s:s.querySelector("input");if(!u)return;const c=s.className.split(" ").find(n=>t.includes(`.${n}`));if(c){const n=a.find(({class_name:f})=>f===c);n&&(u.value=((l=e[n.param])==null?void 0:l.value)||"")}})}}return o});
//# sourceMappingURL=queryform.umd.js.map
